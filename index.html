<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talk & Translate Enhanced</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #e9ecef;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .app-container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      padding: 30px;
    }
    h2 {
      font-weight: bold;
    }
    textarea {
      /* This property enables vertical resizing */
      resize: vertical; 
    }
    .btn, select {
      border-radius: 8px !important;
    }
    .char-buttons button {
      margin: 3px;
      border-radius: 6px;
    }
    .control-panel {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
    }
    .lang-selector {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .lang-selector .col {
      flex: 1;
    }
    #swapLangBtn {
      padding-top: 2rem; /* Align with select boxes */
    }
    @media (max-width: 576px) {
      .control-panel {
        flex-direction: column;
      }
      .lang-selector {
        flex-direction: column;
        gap: 1rem;
      }
      #swapLangBtn {
        padding-top: 0;
        align-self: center;
        transform: rotate(90deg);
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <h2 class="text-center mb-4 text-primary">🗣️ Talk & Translate</h2>
    <div class="row mb-3 lang-selector">
      <div class="col">
        <label for="inputLang" class="form-label">Input Language</label>
        <select id="inputLang" class="form-select">
          <option value="auto">Auto Detect</option>
          <option value="en">English</option>
          <option value="bn">Bengali</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="hi">Hindi</option>
          <option value="ja">Japanese</option>
        </select>
      </div>
      <div id="swapLangBtn" class="col-auto">
         <button type="button" onclick="swapLanguages()" class="btn btn-light" title="Swap Languages">⇄</button>
      </div>
      <div class="col">
        <label for="outputLang" class="form-label">Translate To</label>
        <select id="outputLang" class="form-select">
          <option value="en">English</option>
          <option value="bn">Bengali</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="hi">Hindi</option>
          <option value="ja">Japanese</option>
        </select>
      </div>
    </div>

    <label for="inputText" class="form-label">Input</label>
    <textarea id="inputText" class="form-control mb-3" rows="7" placeholder="Enter text or use the microphone..."></textarea>

    <div class="control-panel mb-3">
      <div>
        <button type="button" onclick="startDictation()" class="btn btn-primary">🎙️ Start</button>
        <button type="button" onclick="clearInput()" class="btn btn-danger">Clear</button>
        <button type="button" onclick="translateText()" class="btn btn-success">Translate</button>
      </div>
      <div>
        <button type="button" onclick="speakOutput()" class="btn btn-info">🔊 Listen</button>
        <button type="button" onclick="copyInput()" class="btn btn-outline-secondary">📋 Copy Input</button>
        <button type="button" onclick="copyOutput()" class="btn btn-outline-secondary">📋 Copy Output</button>
      </div>
    </div>

    <div class="char-buttons mb-3">
      <label class="form-label">Insert Punctuation:</label><br/>
      <button type="button" onclick="insertChar('.')" class="btn btn-light">.</button>
      <button type="button" onclick="insertChar(',')" class="btn btn-light">,</button>
      <button type="button" onclick="insertChar('?')" class="btn btn-light">?</button>
      <button type="button" onclick="insertChar('!')" class="btn btn-light">!</button>
      <button type="button" onclick="insertChar(';')" class="btn btn-light">;</button>
      <button type="button" onclick="insertChar(':')" class="btn btn-light">:</button>
    </div>

    <label for="outputText" class="form-label">Translated Output</label>
    <textarea id="outputText" class="form-control" rows="4" placeholder="Translation will appear here..." readonly></textarea>
  </div>

  <script>
    const inputLang = document.getElementById('inputLang');
    const outputLang = document.getElementById('outputLang');
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');

    function startDictation() {
      if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        // Use the selected language for dictation, default to 'en-US'
        recognition.lang = inputLang.value === 'auto' ? 'en-US' : inputLang.value;
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => console.log('Speech recognition started');
        recognition.onresult = function(event) {
          inputText.value += (inputText.value ? " " : "") + event.results[0][0].transcript;
        };
        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          alert('Speech recognition error: ' + event.error);
        };

        recognition.start();
      } else {
        alert('Speech Recognition is not supported in this browser. Please use Google Chrome.');
      }
    }

    function clearInput() {
      inputText.value = '';
      outputText.value = '';
    }
    
    // NEW FUNCTION: Swap Languages
    function swapLanguages() {
        if (inputLang.value === 'auto') return; // Cannot swap 'auto'
        const tempLang = inputLang.value;
        inputLang.value = outputLang.value;
        outputLang.value = tempLang;
    }

    // NEW FUNCTION: Text-to-Speech for Output
    function speakOutput() {
        const textToSpeak = outputText.value;
        if (!textToSpeak.trim()) {
            alert('There is no output text to listen to.');
            return;
        }
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = outputLang.value; // Set the voice to the output language
            window.speechSynthesis.cancel(); // Cancel any previous speech
            window.speechSynthesis.speak(utterance);
        } else {
            alert('Text-to-Speech is not supported in this browser.');
        }
    }

    function insertChar(char) {
      inputText.value += char;
    }

    function copyInput() {
      navigator.clipboard.writeText(inputText.value);
    }

    function copyOutput() {
      navigator.clipboard.writeText(outputText.value);
    }

    async function translateText() {
      const text = inputText.value;
      const source = inputLang.value;
      const target = outputLang.value;
      if (!text.trim()) {
        alert("Please enter text to translate.");
        return;
      }
      try {
        const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${source}&tl=${target}&dt=t&q=${encodeURIComponent(text)}`);
        const data = await res.json();
        outputText.value = data[0].map(item => item[0]).join('');
      } catch (error) {
        console.error('Translation Error:', error);
        alert('Translation failed. Please check your internet connection or try again later.');
      }
    }
  </script>
</body>
</html>
